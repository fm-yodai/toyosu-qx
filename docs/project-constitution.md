# 豊洲QX「ターレ運用シミュレーション」プロジェクト憲章（Draft v1）

## 1. 背景・課題認識

豊洲市場では多数の仲卸と小売を結ぶ構内配送をターレで行っているが、少量個別発車により積載率低下・待機時間の増大・総走行距離の増大が常態化している。
売買情報のデジタル化は進む一方、物流最適化は未解決である。
この課題への解決策として「ターレ共同運送プラットフォーム」構築を目指す。
まずは日単位・秒粒度の離散事象シミュレーション（DES）で現状を可視化・定量化し、将来は10秒ごとの逐次最適化へ拡張する。

## 2. 目的（アウトカム）

1日分の市場稼働を1秒単位で再現し、ターレ稼働率・稼働時間・待機時間・需給ギャップ等を指標化して可視化する。
次段として、10秒単位の動的タスク再割当が可能なアーキテクチャを準備し、リアルタイム共同運用の効果推定に繋げる。

## 3. 成果目標（KPI）

* ターレ側：稼働率・稼働時間・走行距離・1便平均積載率（W/200kg）。
* 小売側：リードタイム分布（平均・95%点）／充足率／分割納品率。
* 仲卸側：販売消化率／待機在庫時間／タスク待ち行列長。
* 社会効果（評価観点）：重複走行・待機の削減、構内CO₂低減、運用コスト抑制。

## 4. スコープ

### 4.1 インスコープ（Phase 1: 基礎モデル）

* 1秒粒度のDES：主要イベント（積込・出発/到着・荷下ろし・取引確定）とキュー駆動。
* 初期ルール：最大積載200kg、5分（300秒）で現量確定、平均速度8km/h、日次稼働（例4–12時）。
* 入力生成：時間帯強度に基づく需要発生、仲卸割当、キュー運用・出発トリガ。
* 可視化：2Dアニメーション、時系列ダッシュボード、ヒートマップ、サンキー図。

### 4.2 アウトオブスコープ（Phase 1）

* 渋滞・故障・破損・駐車制約などの詳細現実要素（将来拡張）。
* 最適経路・動的再割当の本格導入（Phase 2で評価）。

## 5. 将来拡張（Phase 2: 10秒逐次最適化）

* 意思決定モジュールの独立化、10秒ごとの最適化イベント、状態スナップショット出力、OR-Tools等の外部最適化接続。

## 6. 成果物

* シミュレーションエンジン（Python+SimPy）と可視化ダッシュボード（Matplotlib/Plotlyベース）。
* 入力データスキーマ（仲卸/小売マスタ、距離行列、イベントログ）。
* 分析レポート：KPI算出、感度分析（速度・積込/荷下ろし係数・待機ルール）。
* 再現用シード・シナリオ定義（需要比率、時間窓、混載方針等）。

## 7. 要件（抜粋）

* 物理・運用ルール：200kg上限、10/30/50kg口、5分ルール、平均8km/h、日次ウィンドウ。  
* イベント駆動：秒精度でイベントスケジュール、工程時間は線形式（α・β）＋距離/速度。 
* データ構造：ノードグラフ・距離行列、仲卸/ターレ/イベントキュー/ログ。

## 8. アーキテクチャ方針

* **Core**：SimPyベースのDES（イベントキュー、プロセス、リソース管理）。
* **Planner**：Phase 1はルールベース（最近傍空車配車）。Phase 2で最適化エンジン（OR-Tools/QAOA/アニーリング）へ差替え可能なインターフェース。
* **I/O**：設定（YAML/JSON）、シナリオ（乱数シード・需要曲線）、ログ（時刻・車両・ステータス・位置・積載）。
* **Viz**：ランタイム再生と集計ダッシュボードの両輪。

## 9. 前提・制約・仮定

* **簡略化**：渋滞/故障なし、均一速度（8km/h）。
* **データ**：DXアプリ等から受渡地点・納品先・品目/数量が取得できる前提（ダミーデータで代替可能）。
* **検証**：最適化導入前後の総稼働時間で効果評価。

## 10. マイルストーン

* 2025/7–8：調査・手法選定（DES設計・I/O設計）。
* 2025/9–2026/2：データ定義・整形、モデル実装、KPI出力・可視化。
* 2026/3–4：仲卸10社規模の実証（シナリオ再現＋感度分析）。
* 2026/4–6：改良・効果検証、Phase 2要件定義。

## 11. リスクと対応

* **需要生成の妥当性**：時間帯比率・バスケット構成の仮定が結果を歪める → 実データでの同定・パラメトリック検証を実施。
* **計算負荷**：大規模同時イベントで処理遅延 → イベント駆動＋最適化間隔（10–30秒）調整・分割統治。
* **現実乖離**：渋滞や動線制約を無視 → Phase 2で動線モデルと混雑回避を追加。
* **アルゴリズム選定不確実性**：QAOA/アニーリングの適用範囲 → ルール→OR-Tools→量子ハイブリッドの段階導入。

## 12. 受け入れ条件（Definition of Done）

* 指標一式（§3）がCSV/ダッシュボードで再現可能。
* 基準シナリオでの稼働再現（200kg・5分・8km/h）と一貫性チェック（需要=供給）合格。 
* 10秒最適化の**ダミー枠**（状態スナップショット＋フックI/F）実装済。 

## 13. 成功時の事業価値

取引データ連動の同時最適化により重複走行・待機を削減、コストとCO₂を低減。他市場への水平展開でスケール可能なモデルケースとなる。 

---

### 付録A：主要パラメータ（初期値）

* 速度：8 km/h、取引処理30s、積込/荷下ろし t = αW + β（例：α=0.3 s/kg, β=10 s）
* 運用：200kg上限、10/30/50kgの口割、5分ルール、同一宛先混載（初期）
* 稼働時間帯：例 4:00–12:00（ピークを含む）
